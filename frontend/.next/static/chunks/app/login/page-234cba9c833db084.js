(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{1029:(e,t,s)=>{"use strict";s.d(t,{Ay:()=>l,ri:()=>n,WG:()=>a});let r=()=>{localStorage.removeItem("token"),localStorage.removeItem("role"),localStorage.removeItem("baseId")},o=(0,s(1990).Z0)({name:"auth",initialState:{token:null,role:null,baseId:null},reducers:{setToken(e,t){e.token=t.payload.token,e.role=t.payload.role,e.baseId=t.payload.baseId},logout(e){e.token=null,e.role=null,e.baseId=null,r()}}}),{setToken:a,logout:n}=o.actions,l=o.reducer},1125:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(5155),o=s(2115);class a extends Error{}a.prototype.name="InvalidTokenError";var n=s(5695),l=s(4540),i=s(9360),d=s(1029);function c(){let[e,t]=(0,o.useState)(!0),[s,c]=(0,o.useState)(!1),[u,m]=(0,o.useState)(!1),[h,x]=(0,o.useState)(""),[b,p]=(0,o.useState)(!1),[g,f]=(0,o.useState)([]),[w,v]=(0,o.useState)({username:"",password:""}),[y,j]=(0,o.useState)({username:"",password:"",confirm:"",role:"COMMANDER",base:""}),k=(0,l.wA)(),N=(0,n.useRouter)();(0,o.useEffect)(()=>{(async()=>{try{let e=await i.A.get("/api/bases");f(e.data)}catch(e){console.error("Failed to fetch bases",e)}})()},[]);let C=e=>{v({...w,[e.target.name]:e.target.value})},M=e=>{j({...y,[e.target.name]:e.target.value})},A=async e=>{e.preventDefault(),x(""),p(!0);try{let e=await i.A.post("api/auth/login",w);if(!e.data.token)throw Error("No token received from server");let t=function(e,t){let s;if("string"!=typeof e)throw new a("Invalid token specified: must be a string");t||(t={});let r=+(!0!==t.header),o=e.split(".")[r];if("string"!=typeof o)throw new a(`Invalid token specified: missing part #${r+1}`);try{s=function(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw Error("base64 string is not of the correct length")}try{var s;return s=t,decodeURIComponent(atob(s).replace(/(.)/g,(e,t)=>{let s=t.charCodeAt(0).toString(16).toUpperCase();return s.length<2&&(s="0"+s),"%"+s}))}catch(e){return atob(t)}}(o)}catch(e){throw new a(`Invalid token specified: invalid base64 for part #${r+1} (${e.message})`)}try{return JSON.parse(s)}catch(e){throw new a(`Invalid token specified: invalid json for part #${r+1} (${e.message})`)}}(e.data.token);k((0,d.WG)({token:e.data.token,role:t.role,baseId:t.base})),N.push("/dashboard")}catch(e){var t,s;console.error("Login failed:",e),x((null==(s=e.response)||null==(t=s.data)?void 0:t.message)||e.message||"Login failed. Please try again.")}finally{p(!1)}},S=async e=>{if(e.preventDefault(),x(""),y.password!==y.confirm)return x("Passwords don't match");if("COMMANDER"===y.role&&!y.base)return x("Please select a base for Commander role");p(!0);try{await i.A.post("/api/auth/register",{username:y.username,password:y.password,role:y.role,base:"COMMANDER"===y.role?y.base:void 0}),t(!0),x("Registration successful! Please login."),j({username:"",password:"",confirm:"",role:"COMMANDER",base:""})}catch(e){var s,r;x((null==(r=e.response)||null==(s=r.data)?void 0:s.message)||"Registration failed. Please try again.")}finally{p(!1)}};return(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50 p-4",children:(0,r.jsx)("div",{className:"w-full max-w-md bg-white shadow-lg rounded-xl overflow-hidden transition-all duration-300 ".concat(e?"h-[420px]":"h-[650px]"),children:(0,r.jsxs)("div",{className:"p-8",children:[(0,r.jsxs)("div",{className:"flex mb-8 border-b",children:[(0,r.jsx)("button",{onClick:()=>t(!0),className:"flex-1 py-3 font-medium text-center ".concat(e?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700"),children:"Login"}),(0,r.jsx)("button",{onClick:()=>t(!1),className:"flex-1 py-3 font-medium text-center ".concat(e?"text-gray-500 hover:text-gray-700":"text-blue-600 border-b-2 border-blue-600"),children:"Register"})]}),h&&(0,r.jsx)("div",{className:"mb-4 p-3 text-sm rounded-md ".concat(h.includes("successful")?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:h}),e?(0,r.jsxs)("form",{onSubmit:A,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,r.jsx)("input",{name:"username",type:"text",value:w.username,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your username",required:!0,disabled:b})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{name:"password",type:s?"text":"password",value:w.password,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 pr-10",placeholder:"Enter your password",required:!0,disabled:b}),(0,r.jsx)("button",{type:"button",onClick:()=>c(!s),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500",children:s?(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})]}),(0,r.jsx)("button",{type:"submit",disabled:b,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ".concat(b?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"),children:b?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"w-5 h-5 mr-3 -ml-1 text-white animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):"Sign In"}),(0,r.jsx)("div",{className:"text-center mt-4",children:(0,r.jsx)("button",{type:"button",onClick:()=>t(!1),className:"text-sm text-blue-600 hover:text-blue-800",children:"Don't have an account? Register"})})]}):(0,r.jsxs)("form",{onSubmit:S,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Username"}),(0,r.jsx)("input",{name:"username",type:"text",value:y.username,onChange:M,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Choose a username",required:!0,disabled:b})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,r.jsxs)("select",{name:"role",value:y.role,onChange:M,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",disabled:b,children:[(0,r.jsx)("option",{value:"ADMIN",children:"Admin"}),(0,r.jsx)("option",{value:"LOGISTICS",children:"Logistics Officer"}),(0,r.jsx)("option",{value:"COMMANDER",children:"Base Commander"})]})]}),"COMMANDER"===y.role&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Base"}),(0,r.jsxs)("select",{name:"base",value:y.base,onChange:M,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",required:!0,disabled:b,children:[(0,r.jsx)("option",{value:"",children:"Select Base"}),g.map(e=>(0,r.jsxs)("option",{value:e._id,children:[e.name," - ",e.location]},e._id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{name:"password",type:s?"text":"password",value:y.password,onChange:M,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 pr-10",placeholder:"Create a password",required:!0,disabled:b}),(0,r.jsx)("button",{type:"button",onClick:()=>c(!s),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500",children:s?(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{name:"confirm",type:u?"text":"password",value:y.confirm,onChange:M,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 pr-10",placeholder:"Confirm your password",required:!0,disabled:b}),(0,r.jsx)("button",{type:"button",onClick:()=>m(!u),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-500",children:u?(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}):(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})})})]})]}),(0,r.jsx)("button",{type:"submit",disabled:b,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ".concat(b?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"),children:b?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"w-5 h-5 mr-3 -ml-1 text-white animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Registering..."]}):"Create Account"}),(0,r.jsx)("div",{className:"text-center mt-4",children:(0,r.jsx)("button",{type:"button",onClick:()=>t(!0),className:"text-sm text-blue-600 hover:text-blue-800",children:"Already have an account? Login"})})]})]})})})}},3127:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var r=s(1990),o=s(1029);let a={};{let e=localStorage.getItem("token");a={auth:{token:e,role:localStorage.getItem("role"),baseId:localStorage.getItem("baseId")}}}let n=(0,r.U1)({reducer:{auth:o.Ay},preloadedState:a});n.subscribe(()=>{let{token:e,role:t,baseId:s}=n.getState().auth;localStorage.setItem("token",e||""),localStorage.setItem("role",t||""),localStorage.setItem("baseId",s||"")});let l=n},5146:(e,t,s)=>{Promise.resolve().then(s.bind(s,1125))},5695:(e,t,s)=>{"use strict";var r=s(8999);s.o(r,"useRouter")&&s.d(t,{useRouter:function(){return r.useRouter}})},9360:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var r=s(3464),o=s(3127);let a=r.A.create({baseURL:"http://localhost:3000/api"});a.interceptors.request.use(e=>{let t=o.A.getState().auth.token;return t&&(e.headers.Authorization="Bearer ".concat(t)),e});let n=a}},e=>{var t=t=>e(e.s=t);e.O(0,[990,464,540,441,684,358],()=>t(5146)),_N_E=e.O()}]);